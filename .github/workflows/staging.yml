# Merge into staging when pull requests are approved

on: 
  pull_request_review:
    types: [submitted]
    branches: 'master'

jobs:
  add_to_staging:
    runs-on: ubuntu-latest
    # Add the environment variable for new branch
    env:
      APPROVED_COMMIT: ${{GITHUB_SHA}}

    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0

    # Add the changes to staging
    - name: Merge approved changes to staging
      if: github.event.review.state == 'approved'
      run: |
        git config --global user.name 'Automated Merge'
        git config --global user.email \<\>
        git checkout staging
        git merge --no-ff $APPROVED_COMMIT -m "Commit Approval Staging Merge"
        git push origin staging
